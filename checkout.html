<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout Pesanan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("YriGj6ltxmKl1SXqg"); // Public key EmailJS
    })();
  </script>
</head>
<body class="bg-gradient-to-br from-blue-900 to-blue-700 min-h-screen flex items-center justify-center font-sans">

  <div class="bg-white/10 backdrop-blur-md shadow-xl p-8 rounded-2xl w-full max-w-md text-white border border-white/20">
    <h2 class="text-2xl font-bold mb-6 text-center">Checkout Pesanan</h2>
    
    <form id="checkoutForm" class="space-y-4">
      <div>
        <label class="block text-sm mb-1">Nama Lengkap</label>
        <input type="text" name="nama" required class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
      </div>
      
      <div>
        <label class="block text-sm mb-1">Email</label>
        <input type="email" name="email" required class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
      </div>
      
      <div>
        <label class="block text-sm mb-1">Nomor WhatsApp</label>
        <input type="tel" name="telepon" required class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
      </div>
      
      <div>
        <label class="block text-sm mb-1">Produk</label>
        <input type="text" name="produk" readonly class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
      </div>

      <div>
        <label class="block text-sm mb-1">Harga</label>
        <input type="text" name="harga" readonly class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
      </div>

      <div>
  <label class="block text-sm mb-1">Metode Pembayaran</label>
  <select name="paymentMethod" required class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white">
    <option value="" disabled selected>Pilih Metode</option>
    <option value="VA_AGI">Transfer AGI</option>
    <option value="VA_NOBU">Bank NEO</option>
    <option value="VA_BNI">BNI</option>
    <option value="BRIVA">BRI VA</option>
    <option value="VA_BSI">BSI</option>
    <option value="VA_CIMB">CIMB Niaga</option>
    <option value="VA_DANAMON">Danamon</option>
    <option value="VA_MANDIRI">Mandiri</option>
    <option value="VA_MAYBANK">Maybank</option>
    <option value="VA_PERMATA">Permata</option>
    <option value="VA_SA">Bank Sampoerna</option>
    <option value="ALFAMART">Alfamart</option>
    <option value="POS_INDONESIA">POS Indonesia</option>
    <option value="PEGADAIAN">Pegadaian</option>
    <option value="QRIS">QRIS</option>
  </select>
</div>

      <div>
        <label class="block text-sm mb-1">Kode Voucher</label>
        <input type="text" id="voucher" placeholder="Masukkan kode" class="w-full p-2 rounded-md bg-white/10 border border-white/30 text-white"/>
        <p id="voucherMsg" class="text-sm mt-1"></p>
      </div>

      <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-md transition">Bayar Sekarang</button>
    </form>
  </div>

  <script>
  // Ambil data dari URL
  const params = new URLSearchParams(window.location.search);
  const produk = params.get("produk") || "";
  const harga = params.get("harga") || "";
  const nama = params.get("nama") || "";
  const email = params.get("email") || "";

  // Set nilai awal field
  document.querySelector('input[name="produk"]').value = produk;
  if (harga) {
    document.querySelector('input[name="harga"]').value = "Rp" + parseInt(harga).toLocaleString();
  }
  document.querySelector('input[name="nama"]').value = nama;
  document.querySelector('input[name="email"]').value = email;

  // Fitur voucher
  document.getElementById("voucher").addEventListener("input", function(){
  const hargaField = document.querySelector('input[name="harga"]');
  let originalHarga = parseInt(harga) || 0;
  const msg = document.getElementById("voucherMsg");

  if(this.value.trim() === "") {
    // Kalau kolom kosong, kembalikan harga asli & hapus pesan
    hargaField.value = "Rp" + originalHarga.toLocaleString();
    msg.textContent = "";
    msg.className = "text-sm mt-1";
    return;
  }

  if(this.value.trim().toUpperCase() === "DISKON10"){
    const potongan = originalHarga * 0.1;
    hargaField.value = "Rp" + (originalHarga - potongan).toLocaleString();
    msg.textContent = "Voucher valid! Diskon 10% diterapkan.";
    msg.className = "text-green-400 text-sm mt-1";
  } else {
    hargaField.value = "Rp" + originalHarga.toLocaleString();
    msg.textContent = "Voucher tidak valid.";
    msg.className = "text-red-400 text-sm mt-1";
  }
});

  // Submit EmailJS
document.getElementById("checkoutForm").addEventListener("submit", function(e){
  e.preventDefault();

  const formData = new FormData(this);
  const hargaFinal = document.querySelector('input[name="harga"]').value.replace(/\D/g,'');

  emailjs.sendForm('service_6hr6jio', 'template_zfa3873', this)
    .then(() => {
      // Buat orderId unik setiap checkout
      const orderId = "ORDER" + Date.now();

      const checkoutData = {
  orderId: orderId,
  nama: formData.get("nama"),
  email: formData.get("email"),
  whatsapp: formData.get("telepon"),
  produk: formData.get("produk"),
  harga: hargaFinal,
  paymentMethod: formData.get("paymentMethod")
};

      localStorage.setItem("checkoutData", JSON.stringify(checkoutData));
      window.location.href = "success.html";
    })
    .catch(err => {
      alert("Gagal mengirim pesanan.");
      console.error(err);
    });
});
</script>

</body>
</html>
